---
HIERA_SAFETY_CHECK: true

# We are going to terminate SSL using ELBs
nginx_enable_ssl: false

stackname: "%{::aws_stackname}"
app_domain: "%{::aws_stackname}.govuk.internal"
app_domain_internal: '%{::aws_stackname}.govuk-internal.digital'

backup::mysql::alert_hostname: 'alert'

node_class: &node_class
  asset_master:
    apps:
      - asset_env_sync
  backend:
    apps:
      - asset-manager
      - cache-clearing-service
      - canary-backend
      - collections-publisher
      - contacts
      - content-data-admin
      - content-data-api
      - content-publisher
      - content-tagger
      - hmrc-manuals-api
      - imminence
      - link-checker-api
      - local-links-manager
      - manuals-publisher
      - maslow
      - publisher
      - release
      - search-admin
      - service-manual-publisher
      - short-url-manager
      - sidekiq-monitoring
      - signon
      - specialist-publisher
      - support
      - support-api
      - support_api_csv_env_sync
      - transition
      - travel-advice-publisher
  bouncer:
    apps:
      - bouncer
  cache:
    apps:
      - router
  content_store:
    apps:
      - content-store
  calculators_frontend:
    apps:
      - calculators
      - finder-frontend
      - licencefinder
      - smartanswers
  ckan:
    apps:
      - ckan
  draft_cache:
    apps:
      - authenticating-proxy
      - router
      - router-api
  draft_content_store:
    apps:
      - content-store
  draft_frontend:
    apps:
      - collections
      - email-alert-frontend
      - frontend
      - government-frontend
      - manuals-frontend
      - service-manual-frontend
      - smartanswers
      - static
  email_alert_api:
    apps:
      - email-alert-api
      - email-alert-service
  frontend:
    apps:
      - canary-frontend
      - collections
      - email-alert-frontend
      - feedback
      - frontend
      - government-frontend
      - info-frontend
      - manuals-frontend
      - service-manual-frontend
      - static
  mapit:
    apps:
      - mapit
  mirrorer:
    apps:
      - govuk_crawler_worker
  publishing_api:
    apps:
      - govuk-content-schemas
      - publishing-api
  router_backend:
    apps:
      - router-api
  search:
    apps:
      - search-api
  whitehall_backend:
    apps:
      - whitehall
  whitehall_frontend:
    apps:
      - whitehall

govuk::node::s_base::node_apps:
  <<: *node_class

govuk::node::s_graphite::apt_mirror_hostname: "%{hiera('apt_mirror_hostname')}"
govuk::node::s_graphite::apt_mirror_gpg_key_fingerprint: "%{hiera('apt_mirror_fingerprint')}"

govuk_java::repo::apt_mirror_hostname: "%{hiera('apt_mirror_hostname')}"

# Licensify is a special case because it is not a regular govuk app
# so we only define a Jenkins deploy node app job for it.
govuk_jenkins::deploy_all_apps::apps_on_nodes:
  <<: *node_class
  licensing_frontend:
    apps:
      - licensify
  licensing_backend:
    apps:
      - licensify-admin
      - licensify-feed

# If the repository name is the same as the application name
# we don't need to explicitly declare the repository, but we
# need to add an empty hash
deployable_applications: &deployable_applications
  asset-manager: {}
  authenticating-proxy: {}
  bouncer: {}
  cache-clearing-service: {}
  calculators: {}
  ckan:
    repository: 'ckanext-datagovuk'
  collections: {}
  collections-publisher: {}
  contacts:
    repository: 'contacts-admin'
  content-data-admin: {}
  content-data-api: {}
  content-publisher: {}
  content-store: {}
  content-tagger: {}
  email-alert-api: {}
  email-alert-frontend: {}
  email-alert-service: {}
  feedback: {}
  finder-frontend: {}
  frontend: {}
  government-frontend: {}
  govuk-content-schemas: {}
  govuk_crawler_worker: {}
  govuk-puppet: {}
  hmrc-manuals-api: {}
  imminence: {}
  info-frontend: {}
  licencefinder:
    repository: 'licence-finder'
  licensify: {}
  licensify-admin: {}
  licensify-feed: {}
  link-checker-api: {}
  local-links-manager: {}
  manuals-frontend: {}
  manuals-publisher: {}
  mapit: {}
  maslow: {}
  publisher: {}
  publishing-api: {}
  release: {}
  router: {}
  router-api: {}
  search-api: {}
  search-admin: {}
  service-manual-frontend: {}
  service-manual-publisher: {}
  short-url-manager: {}
  sidekiq-monitoring: {}
  signon: {}
  smartanswers:
    repository: 'smart-answers'
  specialist-publisher: {}
  static: {}
  support: {}
  support-api: {}
  transition: {}
  travel-advice-publisher: {}
  whitehall: {}

apt_mirror_hostname: 'apt.publishing.service.gov.uk'
apt_mirror_gpg_key_fingerprint: '3803E444EB0235822AA36A66EC5FE1A937E3ACBB'

apt::apt_update_frequency: 'daily'
apt::purge_preferences_d: true
apt::purge_sources_list: true
apt::purge_sources_list_d: true
apt::purge:
  preferences.d: true
  sources.list: true
  sources.list.d: true
apt::sources:
  ubuntu:
    location: 'http://gb.archive.ubuntu.com/ubuntu/'
    release: '%{::lsbdistcodename}'
    repos: 'main restricted universe multiverse'
  ubuntu-updates:
    location: 'http://gb.archive.ubuntu.com/ubuntu/'
    release: '%{::lsbdistcodename}-updates'
    repos: 'main restricted universe multiverse'
  ubuntu-backports:
    location: 'http://gb.archive.ubuntu.com/ubuntu/'
    release: '%{::lsbdistcodename}-backports'
    repos: 'main restricted universe multiverse'
  ubuntu-security:
    location: 'http://gb.archive.ubuntu.com/ubuntu/'
    release: '%{::lsbdistcodename}-security'
    repos: 'main restricted universe multiverse'

backup::repo::apt_mirror_hostname: "%{hiera('apt_mirror_hostname')}"
backup::repo::apt_mirror_gpg_key_fingerprint: "%{hiera('apt_mirror_fingerprint')}"

base::packages::gems:
  ruby-shadow:
    ensure: 2.5.0

base::packages::packages:
  - 'ack-grep'
  - 'bzip2'
  - 'daemontools'
  - 'dnsutils'
  - 'dstat'
  - 'gettext'
  - 'git'
  - 'htop'
  - 'iftop'
  - 'iotop'
  - 'iptraf'
  - 'less'
  - 'libc6-dev'
  - 'libcurl4-openssl-dev'
  - 'libreadline-dev'
  - 'libreadline5'
  - 'libsqlite3-dev'
  - 'libxml2-dev'
  - 'libxslt1-dev'
  - 'liblzma-dev'
  - 'logtail'
  - 'mailutils'
  - 'man-db'
  - 'manpages'
  - 'ncdu'
  - 'pv'
  - 'strace'
  - 'tar'
  - 'tcpdump'
  - 'tmux'
  - 'tree'
  - 'update-notifier-common'
  - 'unzip'
  - 'vim-nox'
  - 'xz-utils'
  - 'zip'

collectd::plugin::tcp::metrics:
  - 'ListenOverflows'
  - 'ListenDrops'
  - 'TCPLoss'
  - 'TCPTimeouts'
  - 'TCPFastRetrans'
  - 'TCPLostRetransmit'
  - 'TCPForwardRetrans'
  - 'TCPSlowStartRetrans'
  - 'CurrEstab'
  - 'TCPAbortOnMemory'
  - 'TCPBacklogDrop'
  - 'AttemptFails'
  - 'EstabResets'
  - 'InErrs'
  - 'ActiveOpens'
  - 'PassiveOpens'

collectd::package::apt_mirror_hostname: "%{hiera('apt_mirror_hostname')}"
collectd::package::apt_mirror_gpg_key_fingerprint: "%{hiera('apt_mirror_fingerprint')}"
collectd::plugin::docker::repo: "https://github.com/alphagov/docker-collectd-plugin.git"
collectd::plugin::docker::commit: "e56ddb84536065786e0a55143faa8c6fc035c119"

duplicity::packages::version: '0.7.11-0ubuntu0ppa1263~ubuntu14.04.1'

filebeat::prospectors:
  apt-history:
    paths:
      - '/var/log/apt/history.log'
    tags:
      - 'history'
    fields:
      application: 'apt'
    multiline:
      pattern: '^$'
      negate: true
      match: 'after'
      timeout: 30
  apt-term:
    paths:
      - '/var/log/apt/term.log'
    tags:
      - 'term'
    fields:
      application: 'apt'
  dpkg:
    paths:
      - '/var/log/dpkg.log'
    fields:
      application: 'dpkg'
  syslog:
    paths:
      - '/var/log/syslog'
      - '/var/log/auth.log'
    fields:
      application: 'syslog'
  unattended-upgrades:
    paths:
      - '/var/log/unattended-upgrades/unattended-upgrades.log'
    tags:
      - 'unattended'
    fields:
      application: 'apt'
  unattended-upgrades-shutdown:
    paths:
      - '/var/log/unattended-upgrades/unattended-upgrades-shutdown.log'
    tags:
      - 'unattended'
    fields:
      application: 'apt'

gdal::repo::apt_mirror_hostname: "%{hiera('apt_mirror_hostname')}"
gdal::repo::apt_mirror_gpg_key_fingerprint: "%{hiera('apt_mirror_fingerprint')}"

govuk::apps::publisher::port: 3000
govuk::apps::imminence::port: 3002
govuk::apps::frontend::port: 3005
govuk::apps::smartanswers::port: 3010
govuk::apps::static::port: 3013
govuk::apps::licencefinder::port: 3014
govuk::apps::signon::port: 3016
govuk::apps::whitehall::port: 3020
govuk::apps::feedback::port: 3028
govuk::apps::support::port: 3031
govuk::apps::travel_advice_publisher::port: 3035
govuk::apps::release::port: 3036
govuk::apps::asset_manager::port: 3037
# asset-manager sidekiq monitoring uses 3038
govuk::apps::transition::port: 3044
govuk::apps::calculators::port: 3047
govuk::apps::bouncer::port: 3049
govuk::apps::contacts::port: 3051
govuk::apps::maslow::port: 3053
govuk::apps::router::port: 3054
govuk::apps::router::api_port: 3055
govuk::apps::router_api::port: 3056
govuk::apps::finder_frontend::port: 3062
govuk::apps::specialist_publisher::port: 3064
govuk::apps::content_store::port: 3068
govuk::apps::collections::port: 3070
govuk::apps::hmrc_manuals_api::port: 3071
govuk::apps::manuals_frontend::port: 3072
govuk::apps::search_admin::port: 3073
govuk::apps::govuk_crawler_worker::port: 3074
govuk::apps::support_api::port: 3075
govuk::apps::short_url_manager::port: 3076
govuk::apps::collections_publisher::port: 3078
# publisher sidekiq monitoring uses 3079
# signon sidekiq monitoring uses 3080
# whitehall sidekiq monitoring uses 3081
govuk::apps::info_frontend::port: 3085
# transition sidekiq monitoring uses 3086
govuk::apps::email_alert_api::port: 3088
# email-alert-api sidekiq monitoring uses 3089
govuk::apps::government_frontend::port: 3090
govuk::apps::publishing_api::port: 3093
govuk::apps::email_alert_frontend::port: 3099
govuk::apps::backdrop_read::port: 3101
govuk::apps::backdrop_write::port: 3102
govuk::apps::authenticating_proxy::port: 3107
govuk::apps::mapit::port: 3108
govuk::apps::service_manual_publisher::port: 3111
# publishing-api sidekiq monitoring uses 3114
govuk::apps::content_tagger::port: 3116
# imminence sidekiq monitoring uses 3120
govuk::apps::local_links_manager::port: 3121
govuk::apps::service_manual_frontend::port: 3122
# content-tagger sidekiq monitoring uses 3125
# travel-advice-publisher sidekiq monitoring uses 3203
govuk::apps::manuals_publisher::port: 3205
govuk::apps::link_checker_api::port: 3208
# link-checker-api sidekiq monitoring uses 3209
# specialist-publisher sidekiq monitoring uses 3210
govuk::apps::sidekiq_monitoring::port: 3211
govuk::apps::publishing_components::port: 3212
# manuals-publisher sidekiq monitoring uses 3214
# support-api sidekiq monitoring uses 3215
# collections-publisher sidekiq monitoring uses 3216
govuk::apps::ckan::port: 3220
govuk::apps::ckan::pycsw_port: 3221
govuk::apps::content_publisher::port: 3221
govuk::apps::content_data_admin::port: 3230
govuk::apps::search_api::port: 3233
# search-api sidekiq monitoring uses 3234
govuk::apps::content_data_api::port: 3235
# content-publisher sidekiq monitoring uses 3236
# content-data-api sidekiq monitoring uses 3239
# content-data-admin sidekiq monitoring uses 3240
# search-admin sidekiq monitoring uses 3241

govuk::apps::asset_manager::jwt_auth_secret: "%{hiera('jwt_auth_secret')}"
govuk::apps::asset_manager::mongodb_nodes:
  - 'mongo-1'
  - 'mongo-2'
  - 'mongo-3'
govuk::apps::asset_manager::redis_host: "%{hiera('sidekiq_host')}"
govuk::apps::asset_manager::redis_port: "%{hiera('sidekiq_port')}"
govuk::apps::asset_manager::unicorn_worker_processes: "16"
govuk::apps::asset_manager::nagios_memory_warning: 3000
govuk::apps::asset_manager::nagios_memory_critical: 3300

govuk::apps::authenticating_proxy::jwt_auth_secret: "%{hiera('jwt_auth_secret')}"

govuk::apps::bouncer::db_hostname: "transition-postgresql-standby"
govuk::apps::bouncer::postgresql_role::rds: true
govuk::apps::bouncer::nagios_memory_warning: 1400
govuk::apps::bouncer::nagios_memory_critical: 1500
govuk::apps::bouncer::unicorn_worker_processes: "8"

govuk::apps::cache_clearing_service::enabled: true
govuk::apps::cache_clearing_service::nagios_memory_warning: 2750
govuk::apps::cache_clearing_service::nagios_memory_critical: 3000
govuk::apps::cache_clearing_service::rabbitmq::enabled: true
govuk::apps::cache_clearing_service::rabbitmq_hosts: [rabbitmq]
govuk::apps::cache_clearing_service::rabbitmq::queue_size_critical_threshold: 100000
govuk::apps::cache_clearing_service::rabbitmq::queue_size_warning_threshold: 80000

govuk::apps::ckan::db_hostname: "postgresql-primary"
govuk::apps::ckan::db::backend_ip_range: "%{hiera('environment_ip_prefix')}.3.0/24"
govuk::apps::ckan::db::allow_auth_from_lb: true
govuk::apps::ckan::db::lb_ip_range: "%{hiera('environment_ip_prefix')}.0.0/16"
govuk::apps::ckan::db::rds: true
govuk::apps::ckan::redis_host: "%{hiera('sidekiq_host')}"
govuk::apps::ckan::redis_port: "%{hiera('sidekiq_port')}"
govuk::apps::ckan::ckan_site_url: "http://ckan.dev.gov.uk"
govuk::apps::ckan::gunicorn_worker_processes: "8"
govuk::apps::ckan::s3_aws_access_key_id: "%{hiera('s3_aws_access_key_id')}"
govuk::apps::ckan::s3_aws_secret_access_key: "%{hiera('s3_aws_secret_access_key')}"

govuk::apps::collections::feature_flag_accounts: true
govuk::apps::collections::unicorn_worker_processes: 8
govuk::apps::collections::nagios_memory_warning: 3000
govuk::apps::collections::nagios_memory_critical: 3400

govuk::apps::collections_publisher::db_hostname: "mysql-primary"
govuk::apps::collections_publisher::jwt_auth_secret: "%{hiera('jwt_auth_secret')}"
govuk::apps::collections_publisher::redis_host: "%{hiera('sidekiq_host')}"
govuk::apps::collections_publisher::redis_port: "%{hiera('sidekiq_port')}"

govuk::apps::contacts::redis_host: "%{hiera('sidekiq_host')}"
govuk::apps::contacts::redis_port: "%{hiera('sidekiq_port')}"

govuk::apps::content_data_admin::db_hostname: "postgresql-primary"
govuk::apps::content_data_admin::db::backend_ip_range: "%{hiera('environment_ip_prefix')}.3.0/24"
govuk::apps::content_data_admin::db::allow_auth_from_lb: true
govuk::apps::content_data_admin::db::lb_ip_range: "%{hiera('environment_ip_prefix')}.0.0/16"
govuk::apps::content_data_admin::db::rds: true
govuk::apps::content_data_admin::redis_host: "%{hiera('sidekiq_host')}"
govuk::apps::content_data_admin::redis_port: "%{hiera('sidekiq_port')}"

govuk::apps::content_data_api::rabbitmq_user: "content_data_api"
govuk::apps::content_data_api::rabbitmq_password: "%{hiera('govuk::apps::content_data_api::rabbitmq::amqp_pass')}"
govuk::apps::content_data_api::db_hostname: "content-data-api-postgresql-primary"
govuk::apps::content_data_api::db::lb_ip_range: "%{hiera('environment_ip_prefix')}.0.0/16"
govuk::apps::content_data_api::rabbitmq_hosts:
  - rabbitmq
govuk::apps::content_data_api::redis_host: "%{hiera('sidekiq_host')}"
govuk::apps::content_data_api::redis_port: "%{hiera('sidekiq_port')}"

# Temporarily match up the Content Data API and Content Performance
# Manager database name and user, to make it easier to sync the
# Content Performance Manager database over
govuk::apps::content_data_api::db_name: "content_performance_manager_production"
govuk::apps::content_data_api::db_username: "content_performance_manager"

govuk::apps::content_publisher::db_hostname: "postgresql-primary"
govuk::apps::content_publisher::backend_ip_range: "%{hiera('environment_ip_prefix')}.3.0/24"
govuk::apps::content_publisher::db::allow_auth_from_lb: true
govuk::apps::content_publisher::db::lb_ip_range: "%{hiera('environment_ip_prefix')}.0.0/16"
govuk::apps::content_publisher::db::rds: true
govuk::apps::content_publisher::jwt_auth_secret: "%{hiera('jwt_auth_secret')}"
govuk::apps::content_publisher::aws_region: "eu-west-1"
govuk::apps::content_publisher::redis_host: "%{hiera('sidekiq_host')}"
govuk::apps::content_publisher::redis_port: "%{hiera('sidekiq_port')}"

govuk::apps::content_store::nagios_memory_warning: 4000
govuk::apps::content_store::nagios_memory_critical: 5000
govuk::apps::content_store::unicorn_worker_processes: "15"

govuk::apps::content_tagger::db_hostname: "postgresql-primary"
govuk::apps::content_tagger::db::backend_ip_range: "%{hiera('environment_ip_prefix')}.3.0/24"
govuk::apps::content_tagger::db::allow_auth_from_lb: true
govuk::apps::content_tagger::db::lb_ip_range: "%{hiera('environment_ip_prefix')}.0.0/16"
govuk::apps::content_tagger::enable_procfile_worker: true
govuk::apps::content_tagger::redis_host: "%{hiera('sidekiq_host')}"
govuk::apps::content_tagger::redis_port: "%{hiera('sidekiq_port')}"

govuk::apps::email_alert_api::enabled: true
govuk::apps::email_alert_api::db::backend_ip_range: "%{hiera('environment_ip_prefix')}.3.0/24"
govuk::apps::email_alert_api::db::allow_auth_from_lb: true
govuk::apps::email_alert_api::db::lb_ip_range: "%{hiera('environment_ip_prefix')}.0.0/16"
govuk::apps::email_alert_api::redis_host: "%{hiera('sidekiq_host')}"
govuk::apps::email_alert_api::redis_port: "%{hiera('sidekiq_port')}"
govuk::apps::email_alert_api::db_hostname: "postgresql-primary"
govuk::apps::email_alert_api::db_password: "%{hiera('govuk::apps::email_alert_api::db::password')}"
govuk::apps::email_alert_api::nagios_memory_warning: 2400
govuk::apps::email_alert_api::nagios_memory_critical: 3000
govuk::apps::email_alert_api::unicorn_worker_processes: '10'

govuk::apps::email_alert_frontend::redis_host: "%{hiera('sidekiq_host')}"
govuk::apps::email_alert_frontend::redis_port: "%{hiera('sidekiq_port')}"

govuk::apps::email_alert_service::enabled: true
govuk::apps::email_alert_service::enable_unpublishing_queue_consumer: true
govuk::apps::email_alert_service::rabbitmq_hosts:
  - rabbitmq
govuk::apps::email_alert_service::redis_host: "%{hiera('sidekiq_host')}"
govuk::apps::email_alert_service::rabbitmq::queue_size_critical_threshold: 25
govuk::apps::email_alert_service::rabbitmq::queue_size_warning_threshold: 5

govuk::apps::finder_frontend::enabled: true
govuk::apps::finder_frontend::feature_flag_accounts: true
govuk::apps::finder_frontend::nagios_memory_warning: 2500
govuk::apps::finder_frontend::nagios_memory_critical: 3500
govuk::apps::finder_frontend::unicorn_worker_processes: "6"

govuk::apps::frontend::nagios_memory_warning: 1200
govuk::apps::frontend::nagios_memory_critical: 1400
govuk::apps::frontend::redis_host: "%{hiera('sidekiq_host')}"
govuk::apps::frontend::redis_port: "%{hiera('sidekiq_port')}"
govuk::apps::frontend::unicorn_worker_processes: "4"

govuk::apps::government_frontend::nagios_memory_warning: 3600
govuk::apps::government_frontend::nagios_memory_critical: 4000
govuk::apps::government_frontend::unicorn_worker_processes: "8"

govuk::apps::link_checker_api::db_hostname: "postgresql-primary"
govuk::apps::link_checker_api::db::backend_ip_range: "%{hiera('environment_ip_prefix')}.3.0/24"
govuk::apps::link_checker_api::db::allow_auth_from_lb: true
govuk::apps::link_checker_api::db::lb_ip_range: "%{hiera('environment_ip_prefix')}.0.0/16"
govuk::apps::link_checker_api::redis_host: "%{hiera('sidekiq_host')}"
govuk::apps::link_checker_api::redis_port: "%{hiera('sidekiq_port')}"

govuk::apps::manuals_publisher::redis_host: "%{hiera('sidekiq_host')}"
govuk::apps::manuals_publisher::redis_port: "%{hiera('sidekiq_port')}"
govuk::apps::manuals_publisher::nagios_memory_warning: 1000
govuk::apps::manuals_publisher::nagios_memory_critical: 1200

govuk::apps::mapit::gdal_version: "1.11.5"

govuk::apps::publisher::alert_hostname: 'alert'
govuk::apps::publisher::jwt_auth_secret: "%{hiera('jwt_auth_secret')}"
govuk::apps::publisher::redis_host: "%{hiera('sidekiq_host')}"
govuk::apps::publisher::redis_port: "%{hiera('sidekiq_port')}"

govuk::apps::short_url_manager::redis_host: "%{hiera('sidekiq_host')}"
govuk::apps::short_url_manager::redis_port: "%{hiera('sidekiq_port')}"

govuk::apps::support_api::zendesk_client_username: 'zd-api-govt@digital.cabinet-office.gov.uk/token'

govuk::apps::whitehall::admin_db_hostname: 'mysql-primary'
govuk::apps::whitehall::admin_key_space_limit: '262144'
govuk::apps::whitehall::admin_db_name: whitehall_production
govuk::apps::whitehall::admin_db_password: "%{hiera('govuk::apps::whitehall::db::mysql_whitehall_admin')}"
govuk::apps::whitehall::admin_db_username: whitehall
# TODO this should be using a replica, but we can change that when we have deployed one
govuk::apps::whitehall::db_hostname: 'mysql-primary'
govuk::apps::whitehall::db_name: whitehall_production
govuk::apps::whitehall::db_password: "%{hiera('govuk::apps::whitehall::db::mysql_whitehall')}"
govuk::apps::whitehall::db_username: whitehall_fe
govuk::apps::whitehall::jwt_auth_secret: "%{hiera('jwt_auth_secret')}"
govuk::apps::whitehall::redis_host: "%{hiera('sidekiq_host')}"
govuk::apps::whitehall::redis_port: "%{hiera('sidekiq_port')}"

govuk::apps::whitehall::db::whitehall_fe_password: "%{hiera('mysql_whitehall_frontend')}"

# FIXME: The API can be crawled when https://github.com/alphagov/govuk_crawler_worker/issues/97 is fixed.
govuk::apps::govuk_crawler_worker::blacklist_paths:
  - '/api/'
  - '/apply-for-a-licence'
  - '/business-finance-support-finder'
  - '/drug-device-alerts.atom'
  - '/drug-safety-update.atom'
  - '/foreign-travel-advice.atom'
  - '/government/announcements.atom'
  - '/government/publications.atom'
  - '/government/statistics.atom'
  - '/government/uploads'
  - '/licence-finder'
  - '/search'

govuk::apps::govuk_crawler_worker::enabled: true
govuk::apps::govuk_crawler_worker::root_urls:
  - "https://assets.%{hiera('app_domain')}"
  - "https://www.%{hiera('app_domain')}"

govuk::apps::govuk_crawler_worker::nagios_memory_critical: 1750
govuk::apps::govuk_crawler_worker::nagios_memory_warning: 1500

govuk::apps::imminence::mongodb_nodes:
  - 'mongo-1'
  - 'mongo-2'
  - 'mongo-3'
govuk::apps::imminence::redis_host: "%{hiera('sidekiq_host')}"
govuk::apps::imminence::redis_port: "%{hiera('sidekiq_port')}"
govuk::apps::imminence::nagios_memory_warning: 2400
govuk::apps::imminence::nagios_memory_critical: 2800
govuk::apps::imminence::unicorn_worker_processes: "8"

govuk::apps::info_frontend::enabled: true

govuk::apps::local_links_manager::db_hostname: "postgresql-primary"
govuk::apps::local_links_manager::db::backend_ip_range: "%{hiera('environment_ip_prefix')}.3.0/24"
govuk::apps::local_links_manager::db::allow_auth_from_lb: true
govuk::apps::local_links_manager::db::lb_ip_range: "%{hiera('environment_ip_prefix')}.0.0/16"
govuk::apps::local_links_manager::redis_host: "%{hiera('sidekiq_host')}"
govuk::apps::local_links_manager::redis_port: "%{hiera('sidekiq_port')}"
govuk::apps::local_links_manager::unicorn_worker_processes: "4"
govuk::apps::local_links_manager::nagios_memory_warning: 960
govuk::apps::local_links_manager::nagios_memory_critical: 1100

govuk::apps::mapit::enabled: true

govuk::apps::search_api::rabbitmq_hosts:
  - rabbitmq

govuk::apps::licencefinder::mongodb_nodes:
  - 'mongo-1'
  - 'mongo-2'
  - 'mongo-3'

govuk::apps::publishing_api::unicorn_worker_processes: "8"
govuk::apps::publishing_api::content_store: "https://content-store.%{hiera('app_domain')}"
govuk::apps::publishing_api::db_hostname: "postgresql-primary"
govuk::apps::publishing_api::draft_content_store: "https://draft-content-store.%{hiera('app_domain')}"
govuk::apps::publishing_api::rabbitmq_hosts:
  - rabbitmq
govuk::apps::publishing_api::rabbitmq_password: "%{hiera('govuk::apps::publishing_api::rabbitmq::amqp_pass')}"
govuk::apps::publishing_api::redis_host: "%{hiera('sidekiq_host')}"
govuk::apps::publishing_api::redis_port: "%{hiera('sidekiq_port')}"
govuk::apps::publishing_api::db::backend_ip_range: "%{hiera('environment_ip_prefix')}.3.0/24"
govuk::apps::publishing_api::db::allow_auth_from_lb: true
govuk::apps::publishing_api::db::lb_ip_range: "%{hiera('environment_ip_prefix')}.0.0/16"
govuk::apps::publishing_api::govuk_content_schemas_path: '/data/apps/govuk-content-schemas/current'
govuk::apps::publishing_api::nagios_memory_warning: 2500
govuk::apps::publishing_api::nagios_memory_critical: 3000

govuk::apps::release::db_hostname: "mysql-primary"
govuk::apps::release::db_username: "release"
govuk::apps::release::db_password: "%{hiera('govuk::apps::release::db::mysql_release')}"
govuk::apps::release::github_username: "govuk-ci"

govuk::apps::search_api::nagios_memory_warning: 4600
govuk::apps::search_api::nagios_memory_critical: 4900
govuk::apps::search_api::enable_bulk_reindex_listener: true
govuk::apps::search_api::enable_publishing_listener: true
govuk::apps::search_api::enable_govuk_index_listener: true
govuk::apps::search_api::rabbitmq::enable_bulk_reindex_listener: true
govuk::apps::search_api::rabbitmq::enable_govuk_index_listener: true
govuk::apps::search_api::rabbitmq::enable_publishing_listener: true
govuk::apps::search_api::rabbitmq_user: 'search-api'
govuk::apps::search_api::redis_host: 'backend-redis'
govuk::apps::search_api::redis_port: '6379'
govuk::apps::search_api::unicorn_worker_processes: "9"

govuk::apps::search_admin::db_name: 'search_admin_production'
govuk::apps::search_admin::db_hostname: 'mysql-primary'
govuk::apps::search_admin::db_password: "%{hiera('govuk::apps::search_admin::db::mysql_search_admin')}"
govuk::apps::search_admin::db_username: 'search_admin'
govuk::apps::search_admin::redis_host: "%{hiera('sidekiq_host')}"
govuk::apps::search_admin::redis_port: "%{hiera('sidekiq_port')}"

govuk::apps::service_manual_publisher::http_username: "%{hiera('http_username')}"
govuk::apps::service_manual_publisher::http_password: "%{hiera('http_password')}"
govuk::apps::service_manual_publisher::db_hostname: "postgresql-primary"

govuk::apps::service_manual_publisher::db::backend_ip_range: "%{hiera('environment_ip_prefix')}.3.0/24"
govuk::apps::service_manual_publisher::db::allow_auth_from_lb: true
govuk::apps::service_manual_publisher::db::lb_ip_range: "%{hiera('environment_ip_prefix')}.0.0/16"

govuk::apps::sidekiq_monitoring::asset_manager_redis_host: "%{hiera('govuk::apps::asset_manager::redis_host')}"
govuk::apps::sidekiq_monitoring::asset_manager_redis_port: "%{hiera('govuk::apps::asset_manager::redis_port')}"
govuk::apps::sidekiq_monitoring::collections_publisher_redis_host: "%{hiera('govuk::apps::collections_publisher::redis_host')}"
govuk::apps::sidekiq_monitoring::collections_publisher_redis_port: "%{hiera('govuk::apps::collections_publisher::redis_port')}"
govuk::apps::sidekiq_monitoring::content_data_admin_redis_host: "%{hiera('govuk::apps::content_data_admin::redis_host')}"
govuk::apps::sidekiq_monitoring::content_data_admin_redis_port: "%{hiera('govuk::apps::content_data_admin::redis_port')}"
govuk::apps::sidekiq_monitoring::content_data_api_redis_host: "%{hiera('govuk::apps::content_data_api::redis_host')}"
govuk::apps::sidekiq_monitoring::content_data_api_redis_port: "%{hiera('govuk::apps::content_data_api::redis_port')}"
govuk::apps::sidekiq_monitoring::content_publisher_redis_host: "%{hiera('govuk::apps::content_publisher::redis_host')}"
govuk::apps::sidekiq_monitoring::content_publisher_redis_port: "%{hiera('govuk::apps::content_publisher::redis_port')}"
govuk::apps::sidekiq_monitoring::content_tagger_redis_host: "%{hiera('govuk::apps::content_tagger::redis_host')}"
govuk::apps::sidekiq_monitoring::content_tagger_redis_port: "%{hiera('govuk::apps::content_tagger::redis_port')}"
govuk::apps::sidekiq_monitoring::email_alert_api_redis_host: "%{hiera('govuk::apps::email_alert_api::redis_host')}"
govuk::apps::sidekiq_monitoring::email_alert_api_redis_port: "%{hiera('govuk::apps::email_alert_api::redis_port')}"
govuk::apps::sidekiq_monitoring::imminence_redis_host: "%{hiera('govuk::apps::imminence::redis_host')}"
govuk::apps::sidekiq_monitoring::imminence_redis_port: "%{hiera('govuk::apps::imminence::redis_port')}"
govuk::apps::sidekiq_monitoring::link_checker_api_redis_host: "%{hiera('govuk::apps::link_checker_api::redis_host')}"
govuk::apps::sidekiq_monitoring::link_checker_api_redis_port: "%{hiera('govuk::apps::link_checker_api::redis_port')}"
govuk::apps::sidekiq_monitoring::manuals_publisher_redis_host: "%{hiera('govuk::apps::manuals_publisher::redis_host')}"
govuk::apps::sidekiq_monitoring::manuals_publisher_redis_port: "%{hiera('govuk::apps::manuals_publisher::redis_port')}"
govuk::apps::sidekiq_monitoring::publisher_redis_host: "%{hiera('govuk::apps::publisher::redis_host')}"
govuk::apps::sidekiq_monitoring::publisher_redis_port: "%{hiera('govuk::apps::publisher::redis_port')}"
govuk::apps::sidekiq_monitoring::publishing_api_redis_host: "%{hiera('govuk::apps::publishing_api::redis_host')}"
govuk::apps::sidekiq_monitoring::publishing_api_redis_port: "%{hiera('govuk::apps::publishing_api::redis_port')}"
govuk::apps::sidekiq_monitoring::search_admin_redis_host: "%{hiera('govuk::apps::search_admin::redis_host')}"
govuk::apps::sidekiq_monitoring::search_admin_redis_port: "%{hiera('govuk::apps::search_admin::redis_port')}"
govuk::apps::sidekiq_monitoring::search_api_redis_host: "%{hiera('govuk::apps::search_api::redis_host')}"
govuk::apps::sidekiq_monitoring::search_api_redis_port: "%{hiera('govuk::apps::search_api::redis_port')}"
govuk::apps::sidekiq_monitoring::signon_redis_host: "%{hiera('govuk::apps::signon::redis_host')}"
govuk::apps::sidekiq_monitoring::signon_redis_port: "%{hiera('govuk::apps::signon::redis_port')}"
govuk::apps::sidekiq_monitoring::specialist_publisher_redis_host: "%{hiera('govuk::apps::specialist_publisher::redis_host')}"
govuk::apps::sidekiq_monitoring::specialist_publisher_redis_port: "%{hiera('govuk::apps::specialist_publisher::redis_port')}"
govuk::apps::sidekiq_monitoring::support_api_redis_host: "%{hiera('govuk::apps::support_api::redis_host')}"
govuk::apps::sidekiq_monitoring::support_api_redis_port: "%{hiera('govuk::apps::support_api::redis_port')}"
govuk::apps::sidekiq_monitoring::transition_redis_host: "%{hiera('govuk::apps::transition::redis_host')}"
govuk::apps::sidekiq_monitoring::transition_redis_port: "%{hiera('govuk::apps::transition::redis_port')}"
govuk::apps::sidekiq_monitoring::travel_advice_publisher_redis_host: "%{hiera('govuk::apps::travel_advice_publisher::redis_host')}"
govuk::apps::sidekiq_monitoring::travel_advice_publisher_redis_port: "%{hiera('govuk::apps::travel_advice_publisher::redis_port')}"
govuk::apps::sidekiq_monitoring::whitehall_redis_host: "%{hiera('govuk::apps::whitehall::redis_host')}"
govuk::apps::sidekiq_monitoring::whitehall_redis_port: "%{hiera('govuk::apps::whitehall::redis_port')}"

govuk::apps::signon::db_hostname: 'mysql-primary'
govuk::apps::signon::db_name: 'signon_production'
govuk::apps::signon::db_password: "%{hiera('govuk::apps::signon::db::mysql_signonotron')}"
govuk::apps::signon::db_username: 'signon'
govuk::apps::signon::redis_url: "redis://backend-redis:6379/0"
govuk::apps::signon::redis_host: "%{hiera('sidekiq_host')}"
govuk::apps::signon::redis_port: "%{hiera('sidekiq_port')}"
govuk::apps::signon::nagios_memory_warning: 1300
govuk::apps::signon::nagios_memory_critical: 1450
govuk::apps::signon::unicorn_worker_processes: "4"

govuk::apps::specialist_publisher::enabled: true
govuk::apps::specialist_publisher::nagios_memory_warning: 1100
govuk::apps::specialist_publisher::nagios_memory_critical: 1200
govuk::apps::specialist_publisher::redis_host: "%{hiera('sidekiq_host')}"
govuk::apps::specialist_publisher::redis_port: "%{hiera('sidekiq_port')}"

govuk::apps::smartanswers::nagios_memory_warning: 4000
govuk::apps::smartanswers::nagios_memory_critical: 4500
govuk::apps::smartanswers::unicorn_worker_processes: "4"
govuk::apps::smartanswers::zendesk_client_username: 'zd-api-govt@digital.cabinet-office.gov.uk/token'

govuk::apps::smokey::http_username: "%{hiera('http_username')}"
govuk::apps::smokey::http_password: "%{hiera('http_password')}"
govuk::apps::smokey::smokey_signon_email: "%{hiera('smokey_signon_email')}"
govuk::apps::smokey::smokey_signon_password: "%{hiera('smokey_signon_password')}"
govuk::apps::smokey::smokey_bearer_token: "%{hiera('smokey_bearer_token')}"
govuk::apps::smokey::rate_limit_token: "%{hiera('smokey_rate_limit_token')}"

govuk::apps::static::asset_host: "%{hiera('govuk::deploy::config::website_root')}"
govuk::apps::static::redis_host: "%{hiera('sidekiq_host')}"
govuk::apps::static::redis_port: "%{hiera('sidekiq_port')}"
govuk::apps::static::unicorn_worker_processes: "8"
govuk::apps::static::nagios_memory_warning: 1500
govuk::apps::static::nagios_memory_critical: 1750

govuk::apps::support::redis_host: "%{hiera('sidekiq_host')}"
govuk::apps::support::redis_port: "%{hiera('sidekiq_port')}"
govuk::apps::support::zendesk_anonymous_ticket_email: 'zd-api-public@digital.cabinet-office.gov.uk'
govuk::apps::support::zendesk_client_username: 'zd-api-govt@digital.cabinet-office.gov.uk/token'

govuk::apps::support_api::db_name: 'support_contacts_production'
govuk::apps::support_api::db_hostname: "postgresql-primary"
govuk::apps::support_api::db_password: "%{hiera('govuk::apps::support_api::db::password')}"
govuk::apps::support_api::db_username: 'support_contacts'
govuk::apps::support_api::redis_host: "%{hiera('sidekiq_host')}"
govuk::apps::support_api::redis_port: "%{hiera('sidekiq_port')}"
govuk::apps::support_api::db::backend_ip_range: "%{hiera('environment_ip_prefix')}.3.0/24"
govuk::apps::support_api::db::allow_auth_from_lb: true
govuk::apps::support_api::db::lb_ip_range: "%{hiera('environment_ip_prefix')}.0.0/16"

govuk::apps::transition::db_password: "%{hiera('govuk::apps::transition::postgresql_db::password')}"
govuk::apps::transition::db_hostname: "transition-postgresql-primary"
govuk::apps::transition::postgresql_db::backend_ip_range: "%{hiera('environment_ip_prefix')}.3.0/24"
govuk::apps::transition::redis_host: "%{hiera('sidekiq_host')}"
govuk::apps::transition::redis_port: "%{hiera('sidekiq_port')}"

govuk::apps::travel_advice_publisher::redis_host: "%{hiera('sidekiq_host')}"
govuk::apps::travel_advice_publisher::redis_port: "%{hiera('sidekiq_port')}"

govuk_awscli::apt_mirror_hostname: "%{hiera('apt_mirror_hostname')}"
govuk_awscli::apt_mirror_gpg_key_fingerprint: "%{hiera('apt_mirror_fingerprint')}"

govuk_awscloudwatch::apt_mirror_hostname: "%{hiera('apt_mirror_hostname')}"
govuk_awscloudwatch::apt_mirror_gpg_key_fingerprint: "%{hiera('apt_mirror_fingerprint')}"

govuk::apps::content_data_api::db::rds: true
govuk::apps::content_tagger::db::rds: true
govuk::apps::email_alert_api::db::rds: true
govuk::apps::link_checker_api::db::rds: true
govuk::apps::local_links_manager::db::rds: true
govuk::apps::publishing_api::db::rds: true
govuk::apps::service_manual_publisher::db::rds: true
govuk::apps::support_api::db::rds: true
govuk::apps::transition::postgresql_db::rds: true

govuk_pgbouncer::admin::rds: true
govuk_pgbouncer::db::lb_ip_range: "%{hiera('environment_ip_prefix')}.0.0/16"

govuk_beat::repo::apt_mirror_hostname: "%{hiera('apt_mirror_hostname')}"

govuk_ci::agent::gcloud::apt_mirror_hostname: "%{hiera('apt_mirror_hostname')}"
govuk_ci::agent::gcloud::apt_mirror_gpg_key_fingerprint: "%{hiera('apt_mirror_fingerprint')}"

govuk::deploy::config::app_domain: "%{hiera('app_domain')}"
govuk::deploy::config::asset_root: "https://assets.%{hiera('app_domain')}"
govuk::deploy::config::csp_report_only: true
govuk::deploy::config::csp_report_uri: https://jhpno0hk6b.execute-api.eu-west-2.amazonaws.com/production
govuk::deploy::config::website_root: "https://www.%{hiera('app_domain')}"
govuk::deploy::setup::gemstash_server: 'http://gemstash'
govuk::deploy::sync::jenkins_domain: "deploy.%{hiera('app_domain_internal')}"
govuk::deploy::sync::auth_token: "%{hiera('govuk_jenkins::deploy_all_apps::auth_token')}"

govuk_gor::apt_mirror_hostname: "%{hiera('apt_mirror_hostname')}"
govuk_gor::apt_mirror_gpg_key_fingerprint: "%{hiera('apt_mirror_fingerprint')}"

govuk_htpasswd::http_username: "%{hiera('http_username')}"

govuk_jenkins::packages::gcloud::apt_mirror_hostname: "%{hiera('apt_mirror_hostname')}"
govuk_jenkins::packages::gcloud::apt_mirror_gpg_key_fingerprint: "%{hiera('apt_mirror_fingerprint')}"
govuk_jenkins::packages::terraform::apt_mirror_hostname: "%{hiera('apt_mirror_hostname')}"
govuk_jenkins::packages::terraform::apt_mirror_gpg_key_fingerprint: "%{hiera('apt_mirror_fingerprint')}"
govuk_jenkins::packages::sops::apt_mirror_hostname: "%{hiera('apt_mirror_hostname')}"
govuk_jenkins::packages::sops::apt_mirror_gpg_key_fingerprint: "%{hiera('apt_mirror_fingerprint')}"

govuk_jenkins::jobs::deploy_app::graphite_host: "graphite.%{hiera('app_domain_internal')}"
govuk_jenkins::jobs::deploy_app::graphite_port: '443'
govuk_jenkins::jobs::content_data_api_re_run::re_run_rake_etl_master_process_cron_schedule: '0 3 * * *'

govuk_jenkins::deploy_all_apps::deploy_environment: "%{hiera('govuk_jenkins::job_builder::environment')}"

govuk::node::s_api_redis::allowed_api_ip_range: "%{hiera('environment_ip_prefix')}.4.0/24"
govuk::node::s_api_redis::allowed_backend_ip_range: "%{hiera('environment_ip_prefix')}.3.0/24"

govuk::node::s_apt::apt_service: 'apt'
govuk::node::s_apt::gemstash_service: 'gemstash'
govuk::node::s_apt::private_gpg_key_fingerprint: "%{hiera('apt_mirror_gpg_key_fingerprint')}"

govuk::node::s_asset_base::alert_hostname: 'alert'
govuk::node::s_asset_base::firewall_allow_ip_range: "%{hiera('environment_ip_prefix')}.3.0/24"

govuk::node::s_base::log_remote: false

govuk::node::s_backend_lb::app_specific_static_asset_routes:
  '/asset-manager': "asset-manager"
govuk::node::s_backend_lb::asset_manager_uploaded_assets_routes:
  - '/government/uploads/'
  - '/media/'
govuk::node::s_backend_lb::whitehall_uploaded_assets_routes:
  - '/government/placeholder'
  - '~ ^/government/uploads/system/uploads/attachment_data/file/[0-9]+/.*/preview$'
govuk::node::s_backend_lb::assets_carrenza_vhost_name: "assets-carrenza.%{hiera('app_domain')}"
govuk::node::s_backend_lb::draft_assets_carrenza_vhost_name: "draft-assets-carrenza.%{hiera('app_domain')}"
govuk::node::s_backend_lb::assets_carrenza_vhost_aliases:
  - 'assets.digital.cabinet-office.gov.uk'
  - 'assets.publishing.service.gov.uk'
govuk::node::s_backend_lb::assets_carrenza_real_ip_header: "True-Client-Ip"

govuk::node::s_db_admin::apt_mirror_hostname: "%{hiera('apt_mirror_hostname')}"
govuk::node::s_db_admin::apt_mirror_gpg_key_fingerprint: "%{hiera('apt_mirror_fingerprint')}"

govuk::node::s_content_data_api_db_admin::apt_mirror_hostname: "%{hiera('apt_mirror_hostname')}"

govuk::node::s_gatling::apt_mirror_hostname: "%{hiera('apt_mirror_hostname')}"
govuk::node::s_gatling::apt_mirror_gpg_key_fingerprint: "%{hiera('apt_mirror_fingerprint')}"
govuk::node::s_gatling::repo: 'git@github.com:alphagov/govuk-load-testing.git'
govuk::node::s_gatling::ssh_public_key: "%{hiera('govuk_jenkins::ssh_key::public_key')}"
govuk::node::s_gatling::ssh_private_key: "%{hiera('govuk_jenkins::ssh_key::private_key')}"

govuk::node::s_graphite::apt_mirror_hostname: "%{hiera('apt_mirror_hostname')}"

govuk::node::s_licensing_backend::apt_mirror_hostname: "%{hiera('apt_mirror_hostname')}"
govuk::node::s_licensing_backend::apt_mirror_gpg_key_fingerprint: "%{hiera('apt_mirror_fingerprint')}"

govuk::node::s_licensing_frontend::apt_mirror_hostname: "%{hiera('apt_mirror_hostname')}"
govuk::node::s_licensing_frontend::apt_mirror_gpg_key_fingerprint: "%{hiera('apt_mirror_fingerprint')}"

govuk::node::s_mysql_master::aws_access_key_id: "%{hiera('govuk::node::s_mysql_backup::aws_access_key_id')}"
govuk::node::s_mysql_master::aws_secret_access_key: "%{hiera('govuk::node::s_mysql_backup::aws_secret_access_key')}"
govuk::node::s_mysql_master::encryption_key: "%{hiera('govuk::node::s_mysql_backup::encryption_key')}"

govuk::node::s_transition_db_admin::apt_mirror_hostname: "%{hiera('apt_mirror_hostname')}"

govuk_bundler::config::service: 'http://gemstash'

govuk_postgresql::mirror::apt_mirror_hostname: "%{hiera('apt_mirror_hostname')}"
govuk_postgresql::mirror::apt_mirror_gpg_key_fingerprint: "%{hiera('apt_mirror_fingerprint')}"
govuk_prometheus_node_exporter::repo::apt_mirror_hostname: "%{hiera('apt_mirror_hostname')}"
govuk_prometheus_node_exporter::repo::apt_mirror_gpg_key_fingerprint: "%{hiera('apt_mirror_fingerprint')}"
govuk_prometheus::apt_mirror_hostname: "%{hiera('apt_mirror_hostname')}"
govuk_prometheus::apt_mirror_gpg_key_fingerprint: "%{hiera('apt_mirror_fingerprint')}"
govuk_ppa::apt_mirror_hostname: "%{hiera('apt_mirror_hostname')}"
govuk_ppa::apt_mirror_gpg_key_fingerprint: "%{hiera('apt_mirror_fingerprint')}"

govuk_sshkeys::deployment_keys:
  github.com:
    key: 'AAAAB3NzaC1yc2EAAAABIwAAAQEAq2A7hRGmdnm9tUDbO9IDSwBK6TbQa+PXYPCPy6rbTrTtw7PHkccKrpp0yVhp5HdEIcKr6pLlVDBfOLX9QUsyCOV0wzfjIJNlGEYsdlLJizHhbn2mUjvSAHQqZETYP81eFzLQNnPHt4EVVUh7VfDESU84KezmD5QlWpXLmvU31/yMf+Se8xhHTvKSCZIFImWwoG6mbUoWf9nzpIoaSjB+weqqUUmpaaasXVal72J+UX2B+2RPW3RcT0eOzQgqlJL3RKrTJvdsjE3JEAvGq3lGHSZXy28G3skua2SmVi/w4yCE6gbODqnTWlg7+wC604ydGXA8VJiS5ap43JXiUFFAaQ=='
  github.digital.cabinet-office.gov.uk:
    key: 'AAAAB3NzaC1yc2EAAAADAQABAAABAQC5y+7bm9YIMJXYbSdk2pVzl/w110eFrLIvirT4HKYATp7pxV454T2YoWIvIbtKF7GKz1SwX79uKePmwFKBQ8LIYlmFBbcYf8j3Jl9Px4vcmDPkWjZlfg/aqZUJI3WqwVCNelYM+RTlgtDsME8hIK2FbyPIjotF1WRsE1JgsMLfpzK/rVACGbktfQdmgY+56Ze9WA/rfCCKvrCtdavFR1rNxwkjm+GMImlcgmYTIT8BCEM2pkK0dIEJwKJWBVyyRBcTwHZDgvfVM/EyEfe+gIsgiQTORa1JaScHntH7Q7CBagpXvQHr/tSngGvbSBM1vMRLdtrw8BF5//AmNLOW3glZ'

govuk_cdnlogs::use_tls: '0'
govuk_cdnlogs::service_port_map:
  govuk: 6514
  assets: 6515
  bouncer: 6516

govuk_ci::master::pipeline_jobs:
  <<: *deployable_applications
  # Applications migrated to AWS
  authenticating-proxy: {}
  bouncer: {}
  cache-clearing-service: {}
  calculators: {}
  collections: {}
  content-store: {}
  email-alert-api: {}
  email-alert-frontend: {}
  email-alert-service: {}
  finder-frontend: {}
  frontend: {}
  government-frontend: {}
  imminence: {}
  info-frontend: {}
  content-data-admin: {}
  content-data-api: {}
  licencefinder:
    repository: 'licence-finder'
  link-checker-api: {}
  local-links-manager: {}
  manuals-frontend: {}
  mapit: {}
  publishing-api: {}
  release: {}
  router: {}
  router-api: {}
  search-api: {}
  service-manual-frontend: {}
  smartanswers:
    repository: 'smart-answers'
  static: {}
  support-api: {}
  support: {}
  transition: {}
  # Other repositories
  asset_bom_removal-rails: {}
  backdrop-transactions-explorer-collector: {}
  deprecated_columns: {}
  gds-api-adapters: {}
  gds-sso: {}
  gds_zendesk: {}
  govspeak: {}
  govuk_ab_testing: {}
  govuk_app_config: {}
  govuk-cdn-config: {}
  govuk-csp-forwarder: {}
  govuk-dummy_content_store: {}
  govuk_document_types: {}
  govuk-guix: {}
  govuk-jenkinslib: {}
  govuk_message_queue_consumer: {}
  govuk-provisioning: {}
  govuk_publishing_components: {}
  govuk_seed_crawler: {}
  govuk_schemas: {}
  govuk_sidekiq: {}
  govuk-taxonomy-supervised-learning: {}
  govuk_taxonomy_helpers: {}
  govuk_test: {}
  licensify:
    branches_to_exclude:
      - 'release*'
      - 'deployed-to-integration'
      - 'licensify-deployed-to-integration'
      - 'licensify-admin-deployed-to-integration'
      - 'licensify-feed-deployed-to-integration'
      - 'deployed-to-staging'
      - 'licensify-deployed-to-staging'
      - 'licensify-admin-deployed-to-staging'
      - 'licensify-feed-deployed-to-staging'
      - 'deployed-to-production'
      - 'licensify-deployed-to-production'
      - 'licensify-admin-deployed-to-production'
      - 'licensify-feed-deployed-to-production'
      - 'integration'
      - 'staging'
      - 'production'
  middleman-search: {}
  omniauth-gds: {}
  optic14n: {}
  performanceplatform-client.py: {}
  performanceplatform-collector: {}
  performanceplatform-documentation: {}
  plek: {}
  publishing-e2e-tests: {}
  rack-logstasher: {}
  rails_translation_manager: {}
  router-data: {}
  scss-lint-govuk: {}
  search-api: {}
  shared_mustache: {}
  slimmer: {}
  smokey: {}
  special-route-publisher: {}
  ubuntu_unused_kernels:
    repo_owner: 'gds-operations'
  vcloud-core:
    repo_owner: 'gds-operations'
  vcloud-edge_gateway:
    repo_owner: 'gds-operations'
  vcloud-launcher:
    repo_owner: 'gds-operations'
  vcloud-net_launcher:
    repo_owner: 'gds-operations'
  vcloud-tools:
    repo_owner: 'gds-operations'
  vcloud-tools-tester:
    repo_owner: 'gds-operations'
  vcloud-walker:
    repo_owner: 'gds-operations'

govuk_ci::master::ci_agents:
  ci-agent-1:
    agent_hostname: ci-agent-1.blue.%{hiera('app_domain_internal')}
    labels: 'mongodb-2.4 ci-agent-1 elasticsearch-6.7 terraform postgresql-9.3'
  ci-agent-2:
    agent_hostname: ci-agent-2.blue.%{hiera('app_domain_internal')}
    labels: 'mongodb-2.4 ci-agent-2 elasticsearch-6.7 terraform postgresql-9.3'
  ci-agent-3:
    agent_hostname: ci-agent-3.blue.%{hiera('app_domain_internal')}
    labels: 'mongodb-2.4 ci-agent-3 elasticsearch-6.7 terraform postgresql-9.3'
  ci-agent-4:
    agent_hostname: ci-agent-4.blue.%{hiera('app_domain_internal')}
    labels: 'mongodb-3.2 ci-agent-4 elasticsearch-6.7 terraform postgresql-9.6'
  ci-agent-5:
    agent_hostname: ci-agent-5.blue.%{hiera('app_domain_internal')}
    exclusive: true
    executors: 1
    labels: 'publishing-e2e-tests'
  ci-agent-6:
    agent_hostname: ci-agent-6.blue.%{hiera('app_domain_internal')}
    exclusive: true
    executors: 1
    labels: 'publishing-e2e-tests'
  ci-agent-7:
    agent_hostname: ci-agent-7.blue.%{hiera('app_domain_internal')}
    exclusive: true
    executors: 1
    labels: 'publishing-e2e-tests'
  ci-agent-8:
    agent_hostname: ci-agent-8.blue.%{hiera('app_domain_internal')}
    exclusive: true
    executors: 1
    labels: 'publishing-e2e-tests'

govuk_ci::master::credentials_id: 'jenkins-ssh-slave'

govuk_ci::agent::master_ssh_key: "%{hiera('govuk_jenkins::ssh_key::public_key')}"

govuk_crawler::alert_hostname: 'alert'
govuk_crawler::amqp_host: 'localhost'
govuk_crawler::site_root: "https://www.%{hiera('app_domain')}"

govuk_docker::version: "17.09.0~ce-0~ubuntu"
govuk_docker::repo::apt_mirror_hostname: "%{hiera('apt_mirror_hostname')}"
govuk_docker::repo::apt_mirror_gpg_key_fingerprint: "%{hiera('apt_mirror_fingerprint')}"

govuk_jenkins::package::apt_mirror_hostname: "%{hiera('apt_mirror_hostname')}"
govuk_jenkins::package::apt_mirror_gpg_key_fingerprint: "%{hiera('apt_mirror_fingerprint')}"
govuk_jenkins::config::github_api_uri: "https://api.github.com"
govuk_jenkins::config::github_web_uri: "https://github.com"
govuk_jenkins::jobs::deploy_app::app_domain: "%{hiera('app_domain')}"

govuk_jenkins::jobs::passive_checks::alert_hostname: 'alert'

govuk_jenkins::jobs::smokey::auth_username: "%{hiera('http_username')}"
govuk_jenkins::jobs::smokey::auth_password: "%{hiera('http_password')}"
govuk_jenkins::jobs::smokey::smokey_bearer_token: "%{hiera('smokey_bearer_token')}"
govuk_jenkins::jobs::smokey::signon_email: "%{hiera('smokey_signon_email')}"
govuk_jenkins::jobs::smokey::signon_password: "%{hiera('smokey_signon_password')}"

govuk_jenkins::jobs::run_rake_task::applications: *deployable_applications
govuk_jenkins::jobs::deploy_app::applications: *deployable_applications

govuk_jenkins::jobs::deploy_app_downstream::applications:
  authenticating-proxy: {}
  bouncer: {}
  collections-publisher: {}
  content-data-admin: {}
  content-data-api: {}
  content-publisher: {}
  email-alert-frontend: {}
  finder-frontend: {}
  government-frontend: {}
  hmrc-manuals-api: {}
  info-frontend: {}
  manuals-frontend: {}
  manuals-publisher: {}
  publisher: {}
  short-url-manager: {}
  service-manual-publisher: {}
  smartanswers:
    repository: 'smart-answers'
  travel-advice-publisher: {}

govuk_jenkins::jobs::deploy_lambda_app::lambda_apps:
  - 'email_alert_notifications'

govuk_mysql::xtrabackup::packages::apt_mirror_hostname: "%{hiera('apt_mirror_hostname')}"
govuk_mysql::xtrabackup::packages::apt_mirror_gpg_key_fingerprint: "%{hiera('apt_mirror_fingerprint')}"

govuk_postgresql::server::configure_env_sync_user: true

govuk_rabbitmq::repo::apt_mirror_hostname: "%{hiera('apt_mirror_hostname')}"
govuk_rabbitmq::repo::apt_mirror_gpg_key_fingerprint: "%{hiera('apt_mirror_fingerprint')}"

govuk_rbenv::all::apt_mirror_hostname: "%{hiera('apt_mirror_hostname')}"
govuk_rbenv::all::apt_mirror_gpg_key_fingerprint: "%{hiera('apt_mirror_fingerprint')}"

govuk_solr6::repo::apt_mirror_hostname: "%{hiera('apt_mirror_hostname')}"
govuk_solr6::repo::apt_mirror_gpg_key_fingerprint: "%{hiera('apt_mirror_fingerprint')}"

govuk_python::apt_source::apt_mirror_hostname: "%{hiera('apt_mirror_hostname')}"
govuk_python::apt_source::apt_mirror_gpg_key_fingerprint: "%{hiera('apt_mirror_fingerprint')}"

govuk_sudo::sudo_conf:
  deploy_docker_image:
    content: 'deploy ALL=NOPASSWD:/usr/bin/docker image *'
  deploy_init_ctl:
    content: 'deploy ALL=NOPASSWD:/sbin/initctl'
  deploy_service_docker:
    content: 'deploy ALL=NOPASSWD:/etc/init.d/docker-*'
  deploy_service_memcached:
    content: 'deploy ALL=NOPASSWD:/etc/init.d/memcached'
  deploy_service_nginx:
    content: 'deploy ALL=NOPASSWD:/etc/init.d/nginx'
  deploy_service_varnish:
    content: 'deploy ALL=NOPASSWD:/etc/init.d/varnish'
  deploy_varnishadm:
    content: 'deploy ALL=NOPASSWD:/usr/bin/varnishadm'
  deploy_govuk_unicorn_reload:
    content: 'deploy ALL=NOPASSWD:/usr/local/bin/govuk_unicorn_reload'
  icinga_init_ctl:
    content: 'nagios ALL=NOPASSWD:/sbin/initctl reload *'
  icinga_initctl_restart:
    content: 'nagios ALL=NOPASSWD:/sbin/initctl restart *'
  ubuntu:
    content: 'ubuntu ALL=(ALL) NOPASSWD:ALL'

govuk_splunk::repos::apt_mirror_hostname: "%{hiera('apt_mirror_hostname')}"
govuk_splunk::repos::apt_mirror_gpg_key_fingerprint: "%{hiera('apt_mirror_fingerprint')}"

govuk_unattended_reboot::alert_hostname: 'alert'
govuk_unattended_reboot::enabled: true
govuk_unattended_reboot::mongodb::enabled: true

govuk_unattended_reboot::monitoring_basic_auth:
  username: "%{hiera('http_username')}"
  password: "%{hiera('http_password')}"

grafana::repo::apt_mirror_hostname: "%{hiera('apt_mirror_hostname')}"
grafana::repo::apt_mirror_gpg_key_fingerprint: "%{hiera('apt_mirror_fingerprint')}"
grafana::dashboards::app_domain: "%{hiera('app_domain')}"
grafana::dashboards::machine_suffix_metrics: ''
grafana::dashboards::application_dashboards:
  asset-manager:
    show_sidekiq_graphs: true
    has_workers: true
  authenticating-proxy: {}
  cache-clearing-service: {}
  calculators: {}
  ckan:
    docs_name: 'ckanext-datagovuk'
    # No data in kibana
    show_controller_errors: false
    show_slow_requests: false
  contacts:
    docs_name: 'contacts-admin'
  collections:
    instance_prefix: 'frontend'
    show_memcached: true
  collections-publisher:
    show_sidekiq_graphs: true
    has_workers: true
  content-data-admin:
    show_sidekiq_graphs: true
    has_workers: true
  content-data-api:
    show_sidekiq_graphs: true
    has_workers: true
  content-store:
    dependent_app_5xx_errors:
      - collections
      - contacts
      - email-alert-frontend
      - finder-frontend
      - frontend
      - government-frontend
      - info-frontend
      - manuals-frontend
      - publishing-api
      - smartanswers
      - whitehall-frontend
  content-publisher:
    show_sidekiq_graphs: true
    has_workers: true
  content-tagger:
    show_sidekiq_graphs: true
    has_workers: true
  email-alert-frontend: {}
  email-alert-api:
    show_sidekiq_graphs: true
    has_workers: true
  email-alert-service: {}
  feedback: {}
  finder-frontend:
    rows:
      - - content_store_request_time
        - registry_request_time
        - search_api_request_time
    show_memcached: true
    instance_prefix: 'calculators_frontend'
  frontend: {}
  government-frontend: {}
  hmrc-manuals-api: {}
  imminence:
    dependent_app_5xx_errors:
      - frontend
    show_sidekiq_graphs: true
    has_workers: true
  info-frontend: {}
  licencefinder:
    docs_name: 'licence-finder'
  link-checker-api:
    show_sidekiq_graphs: true
    has_workers: true
  local-links-manager:
    dependent_app_5xx_errors:
      - frontend
    instance_prefix: 'backend'
    show_memcached: true
  maslow: {}
  mapit:
    dependent_app_5xx_errors:
      - frontend
      - imminence
    # No data in kibana
    show_controller_errors: false
    show_slow_requests: false
  manuals-frontend: {}
  manuals-publisher:
    show_sidekiq_graphs: true
    has_workers: true
  publisher:
    show_sidekiq_graphs: true
    has_workers: true
  publishing-api:
    show_sidekiq_graphs: true
    has_workers: true
    instance_prefix: 'publishing_api'
    show_memcached: true
  release: {}
  router: {}
  router-api: {}
  search-api:
    # search-api is a sinatra app
    rows:
      - - reranker_latency_vs_request_count
      - - reranker_errors
      - - search_latency_vs_request_count
        - completion_latency_vs_request_count
        - spelling_latency_vs_request_count
    show_controller_errors: false
    show_response_times: true
    show_sidekiq_graphs: true
    show_slow_requests: false
    has_workers: true
    dependent_app_5xx_errors:
      - collections
      - finder-frontend
      - whitehall-frontend
  search-admin: {}
  service-manual-frontend: {}
  service-manual-publisher: {}
  sidekiq-monitoring: {}
  short-url-manager: {}
  signon:
    show_sidekiq_graphs: true
    has_workers: true
  smartanswers:
    docs_name: 'smart-answers'
  specialist-publisher:
    show_sidekiq_graphs: true
    has_workers: true
  static:
    dependent_app_5xx_errors:
      - collections
      - contacts
      - email-alert-frontend
      - finder-frontend
      - frontend
      - government-frontend
      - manuals-frontend
      - smartanswers
      - whitehall-frontend
  support:
    show_sidekiq_graphs: true
    has_workers: true
  support-api:
    show_sidekiq_graphs: true
    has_workers: true
  transition:
    show_sidekiq_graphs: true
    has_workers: true
  travel-advice-publisher:
    show_sidekiq_graphs: true
    has_workers: true
  whitehall:
    show_sidekiq_graphs: true
    has_workers: true
    error_threshold: 50
    warning_threshold: 25

grub2::recordfail_timeout: 5

icinga::client::config::allowed_hosts: "10.0.0.0/8"
icinga::config::http_username: "%{hiera('http_username')}"
icinga::config::http_password: "%{hiera('http_password')}"

icinga::config::graphite_hostname: "graphite.%{hiera('app_domain_internal')}"

limits::entries:
  'default_core':
    ensure: 'present'
    user: '*'
    limit_type: 'core'
    both: 0
  'default_nproc':
    ensure: 'present'
    user: '*'
    limit_type: 'nproc'
    hard: 256
  'default_nofile':
    ensure: 'present'
    user: '*'
    limit_type: 'nofile'
    hard: 2048

mongodb::backup::alert_hostname: 'alert'
mongodb::repository::apt_mirror_hostname: "%{hiera('apt_mirror_hostname')}"
mongodb::repository::apt_mirror_gpg_key_fingerprint: "%{hiera('apt_mirror_fingerprint')}"
mongodb::server::version: '2.6.12'

monitoring::checks::aws_origin_domain: 'dev.govuk.digital'
monitoring::checks::http_username: "%{hiera('http_username')}"
monitoring::checks::http_password: "%{hiera('http_password')}"
monitoring::client::alert_hostname: 'alert'
monitoring::client::graphite_hostname: 'graphite'
monitoring::contacts::slack_icinga_status_cgi_url: "https://alert.%{::aws_environment}.govuk.digital/cgi-bin/icinga/status.cgi"
monitoring::contacts::slack_icinga_extinfo_cgi_url: "https://alert.%{::aws_environment}.govuk.digital/cgi-bin/icinga/status.cgi"

monitoring::checks::smokey::features:
  check_ab_testing:
    feature: ab_testing
  check_assets:
    feature: assets
  check_benchmarking:
    feature: benchmarking
  check_caching:
    feature: caching
  check_collections:
    feature: collections
  check_contacts:
    feature: contacts
  check_content_data_admin:
    feature: content_data_admin
  check_csv_preview:
    feature: csv_preview
  check_draft_environment:
    feature: draft_environment
  check_feedback:
    feature: feedback
  check_finder_frontend:
    feature: finder_frontend
  check_foreign_travel_advice:
    feature: foreign_travel_advice
  check_frontend:
    feature: frontend
  check_gov_uk:
    feature: gov_uk
  check_gov_uk_redirect:
    feature: gov_uk_redirect
  check_government_frontend:
    feature: government_frontend
  check_licence_finder:
    feature: licence_finder
  check_licensing:
    feature: licensing
  check_manuals_frontend:
    feature: manuals_frontend
  check_mirror:
    feature: mirror
  check_performance_platform:
    feature: performance_platform
  check_public_api:
    feature: public_api
  check_publishing_tools:
    feature: publishing_tools
  check_router:
    feature: router
  check_service_manual:
    feature: service_manual
  check_signon:
    feature: signon
  check_smartanswers:
    feature: smartanswers
  check_transition:
    feature: transition
  check_waf:
    feature: waf
  check_whitehall:
    feature: whitehall

monitoring::checks::cache::servers:
  - 'backend-redis-001'
  - 'backend-redis-002'

monitoring::checks::rds::servers:
   - 'postgresql-primary'
   - 'postgresql-standby'
   - 'transition-postgresql-primary'
   - 'transition-postgresql-standby'
   - 'mysql-primary'
   - 'mysql-replica'

monitoring::uptime_collector::aws: true

# FIXME: this has been added to avoid a bug until we move to v3 of the module
mysql::client::package_ensure: 'present'

nginx::package::apt_mirror_hostname: "%{hiera('apt_mirror_hostname')}"
nginx::package::apt_mirror_gpg_key_fingerprint: "%{hiera('apt_mirror_fingerprint')}"
nginx::package::nginx_version: "1.14.0-1~trusty"

nodejs::repo::apt_mirror_hostname: "%{hiera('apt_mirror_hostname')}"
nodejs::repo::apt_mirror_gpg_key_fingerprint: "%{hiera('apt_mirror_fingerprint')}"
nodejs::version: '12.18.2-1nodesource1'

ntp::server_list:
  - 'ntp.ubuntu.com'
  - 'time.euro.apple.com'
  - '0.uk.pool.ntp.org'
  - '1.uk.pool.ntp.org'
  - '2.uk.pool.ntp.org'

postgresql::lib::devel::link_pg_config: false
postgresql::globals::version: '9.3'

puppet::puppetserver::puppetdb_version: '2.0.0-1puppetlabs1'
puppet::puppetdb::database_password: ''

puppet::monitoring::alert_hostname: 'alert'

puppet::repository::apt_mirror_hostname: "%{hiera('apt_mirror_hostname')}"
puppet::repository::apt_mirror_gpg_key_fingerprint: "%{hiera('apt_mirror_fingerprint')}"

rabbitmq::delete_guest_user: true
rabbitmq::config_stomp: true
# Always use our mirror because they only provide the latest package.

rcs::fsckfix: 'YES'
rcs::tmptime: '7'

router::assets_origin::whitehall_uploaded_assets_routes:
  - '/government/placeholder'
  - '~ ^/government/uploads/system/uploads/attachment_data/file/[0-9]+/.*/preview$'

router::assets_origin::asset_manager_uploaded_assets_routes:
  - '/government/uploads/'
  - '/media/'

router::assets_origin::vhost_aliases:
  - 'assets.digital.cabinet-office.gov.uk'
  - 'assets.publishing.service.gov.uk'
  - 'assets.production.govuk.digital'

router::assets_origin::website_root: "%{hiera('govuk::deploy::config::website_root')}"

router::nginx::check_requests_warning: '@10'
router::nginx::check_requests_critical: '@8'
router::nginx::robotstxt: |
  User-agent: *
  Disallow: /*/print$
  # Don't allow indexing of user needs pages
  Disallow: /info/*
  Sitemap: https://www.gov.uk/sitemap.xml

  # https://ahrefs.com/robot/ crawls the site frequently
  User-agent: AhrefsBot
  Crawl-delay: 10

  # https://www.deepcrawl.com/bot/ makes lots of requests. Ideally
  # we'd slow it down rather than blocking it but it doesn't mention
  # whether or not it supports crawl-delay.
  User-agent: deepcrawl
  Disallow: /

  # Complaints of 429 'Too many requests' seem to be coming from SharePoint servers
  # (https://social.msdn.microsoft.com/Forums/en-US/3ea268ed-58a6-4166-ab40-d3f4fc55fef4)
  # The robot doesn't recognise its User-Agent string, see the MS support article:
  # https://support.microsoft.com/en-us/help/3019711/the-sharepoint-server-crawler-ignores-directives-in-robots-txt
  User-agent: MS Search 6.0 Robot
  Disallow: /

  # Google's crawler was sending requests for each variation of query param for the sectors page of licence-finder
  # resulting in millions of requests a day.
  User-agent: Googlebot
  Disallow: /licence-finder/*

sidekiq_host: 'backend-redis'
sidekiq_port: '6379'

ssh::config::allow_users_enable: true

statsd::repo::apt_mirror_hostname: "%{hiera('apt_mirror_hostname')}"
statsd::repo::apt_mirror_gpg_key_fingerprint: "%{hiera('apt_mirror_fingerprint')}"
govuk_unattended_reboot::repo::apt_mirror_hostname: "%{hiera('apt_mirror_hostname')}"
govuk_unattended_reboot::repo::apt_mirror_gpg_key_fingerprint: "%{hiera('apt_mirror_fingerprint')}"

unattended_reboot::cron_env_vars:
  - 'MAILTO=""'
unattended_reboot::cron_hour: '0-5'
unattended_reboot::etcd_endpoints:
  - "http://etcd.%{hiera('app_domain_internal')}:2379"

unattended_upgrades::blacklist:
 - 'mysql-server.*'

unattended_upgrades::mail_to: 'machine.email@digital.cabinet-office.gov.uk'
unattended_upgrades::origins:
 - "%{::lsbdistid} stable"
 - "%{::lsbdistid} %{::lsbdistcodename}-security"

unicornherder::version: '0.2.1'

yarn::repo::apt_mirror_hostname: "%{hiera('apt_mirror_hostname')}"
yarn::repo::apt_mirror_gpg_key_fingerprint: "%{hiera('apt_mirror_fingerprint')}"
