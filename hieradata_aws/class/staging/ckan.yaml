---

govuk::apps::ckan::enabled: true

govuk_sudo::sudo_conf:
  govuk-backup:
    content: 'govuk-backup ALL=NOPASSWD:/usr/bin/psql,/usr/bin/dropdb,/usr/bin/dropuser,/usr/bin/pg_restore,/usr/bin/pg_dump'
  env-sync-script:
    content: 'Cmnd_Alias BACKUP=/usr/local/bin/govuk_env_sync.sh'

govuk_env_sync::tasks:
  pull_ckan_production_daily:
    ensure: present
    hour: '3'
    minute: '15'
    action: pull
    dbms: postgresql
    storagebackend: 's3'
    database: ckan_production
    temppath: /tmp/ckan_production_pull
    url: govuk-production-database-backups
    path: postgresql-backend
